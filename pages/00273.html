<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>Bright Muff</title>
  <link rel="stylesheet" href="../styles.css">
  <link rel="icon" href="img/favicon.png" type="image/png">
</head>
<body>
<header>
</header>
<main>
  <h1>Bright Muff</h1>
  <p align="right">2021年12月11日　カテゴリー：<a href="00275.html">修理・改造・解析</a></p>
  <hr class="title"><br>
  <a href="img/09_273_1bmP.jpg" target="_blank"><img alt="09_273_1bmP.jpg" border="0" height="320" src="img/09_273_1bmP.jpg" width="480"/></a><br>
<a href="https://tcgakki.com/pages/modified-effector-contest-2021" target="_blank">第1回改造エフェクターコンテスト</a>に向け、Electro-Harmonix Little Big Muff Piにデジタル制御による3チャンネル化を施しました。コンテストにはオリジナルの自作エフェクターでも応募可能だったのですが、コンテスト名に改造とありますし、以前から考えていたデジタルポテンショメータを使ったアナログエフェクターの制御に取り組んでみることにしました。中にスペースがあるエフェクターが改造しやすいので、大きいケースのビッグマフが最適ですが、ケース加工の大変さを考えてLittleサイズの方にしました。ただ、やはりフットスイッチの間隔が狭く踏み間違えそうです（一応スイッチの高さには差をつけてあります）。<br>
<br>
単純に多チャンネル化すると、保存していたプリセットを呼び出した時、各パラメータがどのようになっているか目視できないという問題があります。そこでDarkglassのADAMのように、ポット周囲のLEDでセッティング状況がわかるようにしました（見た目を派手にする目的も兼ねています）。後から思ったことですが、3チャンネル程度だと同じ回路基板を3つ積む方が早い気がします。7セグLEDを使って無駄に10チャンネルあった方が面白かったかもしれません。<br>
<br>
▽回路図・基板画像<br>
<a href="img/09_273_2bmS.png" target="_blank"><img alt="09_273_2bmS.png" border="0" height="274" src="img/09_273_2bmS.png" width="320"/></a><a href="img/09_273_3bmB.jpg" target="_blank"><img alt="09_273_3bmB.jpg" border="0" height="274" src="img/09_273_3bmB.jpg" width="274"/></a><br>
この基板の裏側に元のビッグマフの基板が取り付けられています。ビッグマフ基板はコンデンサの交換等いろいろと変更が必要ですが、マネする人はいないと思うので詳細は省きます。マイコンは、使い慣れている手持ちのSTM32F405を使用しました。<br>
<ul><li>デジタルポテンショメータ（DPOT）<br>
ビッグマフの3つのポット（100kA、100kB、500kA）をDPOTで置き換えることになります。DPOTは抵抗値やカーブの種類が少ないため、全て100kBを使用しており、カーブは内部プログラムで調整しています。また、大抵のDPOTは5Vまでしか扱えないので、より高い電圧が可能なMCP41HV51を使用しています。本来は10V以上推奨ですが、9Vでも問題ないようです。元の回路ではポットを通る信号がGND中心なので、バイアス電圧4.5V中心となるよう変更し、出力にバッファを設けました。<br>
さらに問題点として、DPOTは抵抗値を飛び飛びの値（今回は256段階）でしか設定できないので、抵抗値を変更した時にプツっというノイズがどうしても入ってしまいます。入力信号がゼロに近い（ゼロクロス）時に抵抗値を変更させる回路で軽減できるようですが、演奏時に支障はないのでそこまでは検討しませんでした。プリセット切替時には、切替ノイズを最小限にするため、VOLUMEを1段階ずつ下げて0にする→TONE、SUSTAINの設定変更→音量を1段階ずつ上げるという順番の内部処理となっています。<br>
</li><br>
<li>LEDドライバ<br>
LED点灯の方式にはダイナミック点灯とスタティック点灯があります（参考ページ→<a href="https://www.elec-hobbyist.com/MicomMemo/Pgm_Method/Pgm_method_1.html" target="_blank">LEDのダイナミック点灯</a>）。最初はマイコンとLEDを直接接続してダイナミック点灯させていましたが、ノイズが乗ってしまいました。そこでPCA9635というI2C制御のLEDドライバICを3つ使ってスタティック点灯へ変更しました。このICは簡単に個別のLEDの明るさをPWM制御することができ、大変便利です。<br>
</li><br>
<li>アナログ-デジタル変換（ADC）<br>
元のポットがあった所に別のポットを配置し、このポットの回転角度に応じた電圧をADCで取得することになります。昔<a href="00232.html" target="_blank">NucleoボードのADCを使う</a>という記事を書いていたのが役に立ちました。AD変換速度は遅くてもよいと思っていましたが、ADC完了割り込みのタイミングで少しノイズが発生していたので、ノイズが可聴域外になるよう高速にしています。ADCを高速にすると取得値が揺れ動きやすくなるので、256個の移動平均値を算出するようにしました。</li></ul><br>
▽取扱説明書<br>
コンテスト応募時に同封した説明書です。<br>
<a href="img/09_273_4bmP.png" target="_blank"><img alt="09_273_4bmP.png" border="0" height="415" src="img/09_273_4bmP.png" width="303"/></a><br>
見た目のインパクトのためにLEDはできるだけ明るくしましたが、直視することができず実用上支障が出そうなので、調光モードで明るさを調整できるようにしました。普段はLEDの色による明るさの違いを気にしたことがなかったですが、比べてみると結構な違いでした。青と緑のLEDは電流制限抵抗の値を変えてあります。<br>
<br>
アナログエフェクターのデジタル制御という面では、<a href="00243.html" target="_blank">Tremolec</a>のようにフォトカプラを使った方が自由度が高いように思います。セルフキャリブレーションのような機能を付けることができればフォトカプラのバラつきも許容できるかもしれません。コンテストが続くのかどうかはわかりませんが、また機会があればフォトカプラを使った改造にも挑戦してみたいと思います。<br>
<br>

</main>
<footer>
  <p><a href="../">ホーム</a></p>
  <p>Copyright &copy; 可燃ごみ箱</p>
</footer>
</body>
</html>